# Copyright (C) 2007 Robotics at Maryland
# Copyright (C) 2007 Joseph Lisee <jlisee@umd.edu>
# All rights reserved.
#
# Author: Joseph Lisee <jlisee@umd.edu>
# File:  packages/core/SConscript

import platform

# Pull in build environment from parent SConstruct
Import('env')
envl = env.Clone()

# Find all cpp files in the source directory
sources = envl.Glob('src', '*.cpp')

# Doesn't work right
# Add sources for Subsystem based Interfaces (needed here for wrapping
#if env.HasFeature('vehicle'):
#    sources.append('../vehicle/src/IVehicle.cpp')
if not env.HasFeature('wrappers'):
    sources.remove('src/SubsystemConverter.cpp')
    sources.remove('src/EventConverter.cpp')

testIntDeps = ['core']
if env.HasFeature('math'):
    testIntDeps.append('math')
    
# Build Library (will be called 'libram_core.so')
# Build flags for dependencies automaticallly added based on buildfiles/libs.py
if platform.system() in ['Linux']:
    envl.AppendUnique(CCFLAGS = '-Wno-deprecated')
    envl.AppendUnique(CCFLAGS = '-Wno-unused')
    envl.AppendUnique(CCFLAGS = '-Wno-uninitialized')

envl.RAMSharedLibrary('core', source = sources)

# Build our little demo program
envt = env.Clone()
envt.RAMProgram(target = 'QueueTest',
                source = ['test/src/QueueTest.cpp'], int_deps = testIntDeps)

# Test for updatable class
envt.RAMProgram(target = 'UpdatableTest',
                source = ['test/src/UpdatableTest.cpp'], int_deps = testIntDeps)

envt.RAMProgram(target = 'AvgFilterTest',
                source = ['test/src/AvgTest.cpp'], int_deps = testIntDeps)

# Unit Tests
envt = env.Clone()
if platform.system() in ['Linux']:
    envt.AppendUnique(CCFLAGS = '-Wno-uninitialized')
envt.Tests(int_deps = testIntDeps)
