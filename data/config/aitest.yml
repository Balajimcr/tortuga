GUI:
    updateRate: 5

# Config for the vehicle
# Each module is a seperate system that needs to be started up
Subsystems:    
    VisionSystem:
        type: VisionSystem
        depends_on: ["EventHub", "Vehicle"]
        
#       RedLightDetector:       
#           intialMinPixels: 400
#           foundMinPixelScale: 0.85
#           lostMinPixelScale: 0.75
#           # About 20% of the total pixels
#           almostHitPixels: 61440.0
        
        # Recording Settings
        #maxRecordRate: 10 # Hz
        #forwardFile: forward.avi
        #downwardFile: downward.avi
#        forwardPort: 50000
    
    EventHub:
        type: EventHub

    # Queues events from background threads so they can be executed in python
    QueuedEventHub:
        depends_on: ["EventHub"]
        type: QueuedEventHub

    # Exectures Motions
    MotionManager:
        type: MotionManager
        depends_on: ["Vehicle", "Controller", "QueuedEventHub", "EventHub"]

    # Handles Timers
    TimerManager:
        type: TimerManager
        depends_on: ["EventHub"]

    StateMachine:
        type: StateMachine
        depends_on: ["EventHub", "QueuedEventHub", "Controller",
                     "MotionManager", "TimerManager", "VisionSystem"]
        States:
            ram.ai.light.Seek:
                depthGain: 0.5
            ram.ai.duct.SeekingToRange:
                filterSize: 10
                desiredRange: 0.5
            ram.ai.duct.SeekingToAligned:
                filterSize: 10
                desiredRange: 0.5
            ram.ai.duct.Aligning:
                filterSize: 10
                desiredRange: 0.5

    # Object that creates the vehicle interface
    Vehicle:
        # The full name of the class to instantiate in this case its a wrapper
        # for the base C++ vehicle
        type: Vehicle
        # Time between updates in ms
        update_interval: 25
     
        depends_on: ["EventHub", "Logging"]

        # Pressure tranducer calibration 
        depthCalibSlope: 35.4
        depthCalibIntercept: 1183

        # The list of devices to create for the vehicle
        Devices:
            # NOTE: All current numbers here are BS and need to updated

            SensorBoard:
                type: SensorBoard
                update_interval: 25
                depthCalibSlope: 35.5
                depthCalibIntercept: 1182

            Battery1:
                depends_on: ['SensorBoard']
                type: SBPowerSource
                id: 0

            Battery2:
                depends_on: ['SensorBoard']
                type: SBPowerSource
                id: 1

            Batter3:
                depends_on: ['SensorBoard']
                type: SBPowerSource
                id: 2

            Battery4:
                depends_on: ['SensorBoard']
                type: SBPowerSource
                id: 3

            Shore:
                depends_on: ['SensorBoard']
                type: SBPowerSource
                id: 4

            Temp1:
                depends_on: ['SensorBoard']
                type: SBTempSensor
                id: 0

            Temp2:
                depends_on: ['SensorBoard']
                type: SBTempSensor
                id: 5

            Temp3:
                depends_on: ['SensorBoard']
                type: SBTempSensor
                id: 6

            # This entry creates a thruster
            StarboardThruster:
                depends_on: ['SensorBoard']
                # serial: 147
                type: SBThruster
                update_interval: 100

                # String representing the address of the thruster
                address: 1
                # Number determined by testing
                calibration_factor: 0.3652
                # Number used to flip thruster forces (if thruster is reversed
                
                # on the vehicle)
                direction: 1
                # Distance from center of rotation
                offset: 0.1983
            PortThruster:
                depends_on: ['SensorBoard']
                # serial: 149
                type: SBThruster
                address: 0
                calibration_factor: 0.4146
                direction: 1
                offset: 0.1983

            ForeThruster:
                depends_on: ['SensorBoard']
                type: SBThruster
                # serial: 146
                address: 3
                calibration_factor: 0.4368
                direction: -1
                offset: 0.2729

            AftThruster:
                depends_on: ['SensorBoard']
                # Serial 148
                type: SBThruster
                address: 5
                calibration_factor: 0.3612
                direction: -1
                offset: 0.4253

            TopThruster:
                depends_on: ['SensorBoard']
                # serial: 149
                type: SBThruster
                address: 2
                calibration_factor: 0.4146
                direction: 1
                offset: 0.1967

            BottomThruster:
                depends_on: ['SensorBoard']
                type: SBThruster
                address: 4
                calibration_factor: 0.3652
                direction: -1
                offset: 0.1967



            IMU:
                type: IMU
                update_interval: 5
                # These are in VEHICLE FRAME
                # Pre-thruster change out
                #magXBias: -0.229488
                #magYBias: 0.270406
                #magZBias: 0.158325
                # Post Thruster change out, and with 6 thrusters
                #magXBias: -0.260058
                #magYBias: 0.211263
                #magZBias: 0.243511
                # New Electronics
                #magXBias: -0.269084
                #magYBias: 0.221182
                #magZBias: 0.243998
                # Tortuga 2 first dive
                magXBias: -0.196805
                magYBias: 0.171669
                magZBias: 0.251043

                localMagneticPitch: 60
    RemoteController:
        type: RemoteController
        depends_on: ["Controller"]
        update_interval: -1
        yawGain: 50

    Logging:
        type: Logging
        update_interval: -1
        Appenders:
            SBLog:
                type: File
                fileName: thrusters.log
                Layout:
                    type: Pattern
                    pattern: "%m %r%n"
            ControlLog:
                type: File
                fileName: control.log
                Layout:
                    type: Pattern
                    pattern: "%m %r%n"
            Console:
                type: Console
                Layout:
                    type: Pattern
                    pattern: "%c %m %r%n"
        Categories:
            SensorBoard:
                appenders: ['SBLog'] #,'Console']
            Controller:
                appenders: ['ControlLog'] #'Console']

    Controller:
        depends_on: ["Vehicle", "EventHub"]
        type: BWPDController
        update_interval: 40
        orientationThreshold: 0.05

        angularPGain: 5
        angularDGain: 1
        speedPGain: 3
        sidewaysSpeedPGain: 3
        # Should not be negative
        depthPGain: 20

#        inertia: [[0.501, 0, 0],
#                  [0, 1.5, 0],
#                  [0, 0, 1.5]]

        desiredSpeed: 0
        desiredDepth: 0
        desiredQuaternion: [0, 0, 0, 1]

        # Picks kind of depth controller
        # 1 = P control (Normal)
        # 4 = Dis. Obs. w/Integral Aug.
        # 5 = PID
        depthControlType: 1

        # Discrete Observer Controller w/Integral Aug. (#4)
        depthOCIA4: [0, 12217, -469, 0,
                     0, 0, 0, 0,
                     0, -9, 0, 0,
                     0, 2932, 49, 1]
        depthOCIB4: [-12221, 1, 9, -2937]
        depthOCIC4: [0, 0, 0, 1]

        # Settings for PID Depth Controller (#5)
        depthKp: 10
        depthKd: 4
        depthKi: 1

